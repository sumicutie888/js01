define("main",["require","exports","module"],function(e,t,o){"use strict";function r(e,t){function o(){e.releaseRef(),clearTimeout(l[i]),delete l[i],0===Object.keys(l).length&&u.triggerProjectSaved()}function r(){if(!e.isDirty)return void o();a.execute({doc:e}).done(o).fail(function(e){console.error("[Autosave] failed write for `"+i+"`",e),o()})}var i=e.file.fullPath;l[i]&&!t||(e.addRef(),t?r():l[i]=setTimeout(r,n))}var n=5e3,i=brackets.getModule("command/Commands").FILE_SAVE,a=brackets.getModule("command/CommandManager").get(i),c=brackets.getModule("document/DocumentManager"),d=brackets.getModule("editor/EditorManager"),u=brackets.getModule("bramble/BrambleEvents"),l={};c.on("dirtyFlagChange",function(e,t){t.isDirty&&(u.triggerProjectDirty(t.file.fullPath),r(t))}),d.on("activeEditorChange",function(e,t,o){o&&o.document.isDirty&&r(o.document,!0)})});